<?php
// Activer le reporting d'erreurs complet
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);

// === LIB TCPDF ===
require_once('TCPDF-master/tcpdf.php');

require_once('vendor/autoload.php');
use setasign\Fpdi\Tcpdf\Fpdi;

// === CONFIGURATION PDF ===
$pageLayout = array(154, 157.7);
$pdf = new FPDI('F', 'mm', $pageLayout, true, 'UTF-8', false);
$pdf->setFontSubsetting(false);
$pdf->setPrintHeader(false);
$pdf->setPrintFooter(false);
$pdf->SetMargins(0, 0, 0, 0);
$pdf->SetAutoPageBreak(false, 0);
$pdf->setImageScale(PDF_IMAGE_SCALE_RATIO);

// Langue
if (@file_exists(dirname(__FILE__) . '/lang/fra.php')) {
	require_once(dirname(__FILE__) . '/lang/fra.php');
	$pdf->setLanguageArray($l);
}

// === DÉBUT PAGE ===
$pdf->AddPage();

// Import des pages du PDF existant
$pdf->setSourceFile(dirname(__DIR__) . '/images/pub-sponso-1.pdf');
$templateId = $pdf->importPage(1);
$pdf->useTemplate($templateId, 0, 0, 154.7);

$pdf->setSourceFile(dirname(__DIR__) . '/images/fond-carte.pdf');
$templateId = $pdf->importPage(1);
$pdf->useTemplate($templateId, 0, 81, 154.7);

// === TRAITEMENT JSON ===
$jsonDate = date('Y-m-d', strtotime('+1 day'));
$jsonFile = dirname(__DIR__) . '/datas/nouvelle_aquitaine_demain_' . $jsonDate . '.json';

if (!file_exists($jsonFile)) {
    die("Erreur: Le fichier JSON pour demain est introuvable \u00e0 l'emplacement : $jsonFile");
}

$jsonData = file_get_contents($jsonFile);
$data = json_decode($jsonData, true);

if (json_last_error() !== JSON_ERROR_NONE) {
    die("Erreur de d\u00e9codage JSON : " . json_last_error_msg());
}

// Mappage des codes qualit\u00e9 de pollen aux couleurs
$pollen_colors = [
    1 => '#70caf3', // Très faible
    2 => '#61bda4', // Faible
    3 => '#efe643', // Modéré
    4 => '#ea5254', // Elevé
    5 => '#951635',  // Très élevé
    6 => '#a7177f',  // Extrêment élevé
    7 => '#8a8a8a'  // Indisponible
];

// === DÉFINITION DES TRACÉS SVG ===
$air_fond_paths = [
    '17300' => 'M53.6,37.3c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S58.3,37.3,53.6,37.3z',
    '17299' => 'M65.1,52.4c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S69.8,52.4,65.1,52.4z',
    '33063' => 'M70.1,97.3c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S74.8,97.3,70.1,97.3z',
    '33243' => 'M78.8,96.4c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S83.5,96.4,78.8,96.4z',
    '33009' => 'M49.4,107.5c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S54,107.5,49.4,107.5z',
    '47001' => 'M108.7,127.4c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S113.3,127.4,108.7,127.4z',
    '40088' => 'M54,145.5c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S58.6,145.5,54,145.5z',
    '40192' => 'M71.4,141.4c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S76.1,141.4,71.4,141.4z',
    '64102' => 'M39.4,157.7c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S44.1,157.7,39.4,157.7z',
    '64445' => 'M75.5,166.8c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S80.1,166.8,75.5,166.8z',
    '47157' => 'M91.6,116c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S96.2,116,91.6,116z',
    '24322' => 'M109.9,80.6c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S114.6,80.6,109.9,80.6z',
    '24037' => 'M102.8,98.1c-4.7,0-8.5-3.8-8.5-8.5s3.8-8.5,8.5-8.5s8.5,3.8,8.5,8.5S107.5,98.1,102.8,98.1z'
];

$air_picto_paths = [
    '17300' => 'M53.2,23.8c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S54.3,23.8,53.2,23.8C53.3,23.8,53.2,23.8,53.2,23.8L53.2,23.8z M57.5,25.6c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S58.4,25.6,57.5,25.6z M48.4,30.2c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L48.4,30.2L48.4,30.2z',
    '17299' => 'M64.7,38.8c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S65.7,38.8,64.7,38.8C64.7,38.8,64.7,38.8,64.7,38.8L64.7,38.8z M68.9,40.7c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S69.9,40.7,68.9,40.7L68.9,40.7z M59.9,45.3c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L59.9,45.3L59.9,45.3z',
    '33063' => 'M69.7,83.8c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S70.8,83.8,69.7,83.8C69.8,83.8,69.8,83.8,69.7,83.8L69.7,83.8z M74,85.6c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S75,85.6,74,85.6z M64.9,90.2c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L64.9,90.2L64.9,90.2z',
    '33243' => 'M78.4,82.9c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S79.4,82.9,78.4,82.9C78.4,82.9,78.4,82.9,78.4,82.9z M82.6,84.7c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S83.6,84.7,82.6,84.7z M73.6,89.4c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L73.6,89.4L73.6,89.4z',
    '47001' => 'M108.3,113.9c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S109.3,113.9,108.3,113.9C108.3,113.9,108.3,113.9,108.3,113.9z M112.5,115.7c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S113.5,115.7,112.5,115.7z M103.5,120.3c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L103.5,120.3L103.5,120.3z',
    '40192' => 'M71,127.9c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8C72.8,128.7,72,127.9,71,127.9C71,127.9,71,127.9,71,127.9L71,127.9z M75.3,129.7c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8C77,130.5,76.2,129.7,75.3,129.7L75.3,129.7z M66.2,134.3c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1c0,0.6-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L66.2,134.3L66.2,134.3z',
    '40088' => 'M53.6,132c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8C55.4,132.9,54.6,132,53.6,132C53.6,132,53.6,132,53.6,132L53.6,132z M57.8,133.8c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8C59.6,134.7,58.8,133.8,57.8,133.8L57.8,133.8z M48.8,138.5c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1c0,0.6-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L48.8,138.5L48.8,138.5z',
    '64102' => 'M39.1,144.2c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8C40.8,145,40.1,144.2,39.1,144.2C39.1,144.2,39.1,144.2,39.1,144.2L39.1,144.2z M43.3,146c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8C45,146.8,44.3,146,43.3,146L43.3,146z M34.2,150.7c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1c0,0.6-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L34.2,150.7L34.2,150.7z',
    '64445' => 'M75.1,153.2c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S76.9,154.1,75.1,153.2C75.1,153.2,75.1,153.2,75.1,153.2L75.1,153.2z M79.3,155.1c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1c0,0.6-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S81.1,155.9,79.3,155.1z M70.3,159.7c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1c0,0.6-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0H70.3L70.3,159.7z',
    '47157' => 'M91.2,102.5c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S92.2,102.5,91.2,102.5C91.2,102.5,91.2,102.5,91.2,102.5z M95.4,104.3c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S96.4,104.3,95.4,104.3z M86.4,108.9c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4H92c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L86.4,108.9L86.4,108.9z',
    '33009' => 'M49,94c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4H49c1,0,1.8-0.8,1.8-1.8S50,94,49,94C49,94,49,94,49,94L49,94z M53.2,95.9c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S54.2,95.9,53.2,95.9z M44.2,100.5c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0C49.8,100.5,44.2,100.5,44.2,100.5z',
    '17300' => 'M53.2,23.8c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S54.3,23.8,53.2,23.8C53.3,23.8,53.2,23.8,53.2,23.8L53.2,23.8z M57.5,25.6c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S58.4,25.6,57.5,25.6z M48.4,30.2c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L48.4,30.2L48.4,30.2z',
    '24322' => 'M109.6,67.1c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S110.6,67.1,109.6,67.1C109.6,67.1,109.6,67.1,109.6,67.1z M113.8,68.9c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S114.8,68.9,113.8,68.9z M104.8,73.6c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L104.8,73.6L104.8,73.6z',
    '24037' => 'M102.4,84.6c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4c0,0,0,0,0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-4.9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h4.9c1,0,1.8-0.8,1.8-1.8S103.4,84.6,102.4,84.6C102.4,84.6,102.4,84.6,102.4,84.6z M106.7,86.5c-1,0-1.7,0.8-1.7,1.8c0,0.2,0.2,0.4,0.4,0.4l0,0c0.2,0,0.4-0.2,0.4-0.4c0,0,0,0,0,0c0-0.6,0.4-1,1-1s1,0.4,1,1s-0.4,1-1,1h-9c-0.2,0-0.4,0.2-0.4,0.4c0,0.2,0.2,0.4,0.4,0.4h9c1,0,1.8-0.8,1.8-1.8S107.6,86.5,106.7,86.5z M97.6,91.1c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,0.2,0.2,0.4,0.4,0.4h5.6c0.5,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1c0-0.2-0.2-0.4-0.4-0.4c0,0,0,0,0,0c-0.2,0-0.4,0.2-0.4,0.4l0,0c0,1,0.8,1.8,1.7,1.8s1.8-0.8,1.8-1.8c0-1-0.8-1.8-1.7-1.8c0,0,0,0,0,0L97.6,91.1L97.6,91.1z'
];

$pollen_paths = [
    '17300' => 'M203.8,33.9L203.8,33.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C204.1,33.9,204,33.9,203.8,33.9C203.9,33.9,203.8,33.9,203.8,33.9z',
    '17299' => 'M215.8,48.9L215.8,48.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C216.1,48.9,216,48.9,215.8,48.9L215.8,48.9L215.8,48.9z',
    '33063' => 'M221.8,94.9L221.8,94.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C222.1,94.9,222,94.9,221.8,94.9L221.8,94.9L221.8,94.9z',
    '33243' => 'M228.8,93.9L228.8,93.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C229.1,93.9,229,93.9,228.8,93.9L228.8,93.9L228.8,93.9z',
    '33009' => 'M199.8,105.9L199.8,105.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C200.1,105.9,200,105.9,199.8,105.9L199.8,105.9L199.8,105.9z',
    '47001' => 'M258.8,124.9L258.8,124.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C259.1,124.9,259,124.9,258.8,124.9L258.8,124.9L258.8,124.9z',
    '40088' => 'M221.8,139.9L221.8,139.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C222.1,139.9,222,139.9,221.8,139.9L221.8,139.9z',
    '40192' => 'M203.8,143.9L203.8,143.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C204.1,143.9,204,143.9,203.8,143.9L203.8,143.9z',
    '64102' => 'M189.8,154.9L189.8,154.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C190.1,154.9,190,154.9,189.8,154.9L189.8,154.9z',
    '64445' => 'M223.8,164.9L223.8,164.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C224.1,164.9,224,164.9,223.8,164.9L223.8,164.9z',
    '47157' => 'M241.8,112.9L241.8,112.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C242.1,112.9,242,112.9,241.8,112.9L241.8,112.9L241.8,112.9z',
    '33009' => 'M199.8,105.9L199.8,105.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C200.1,105.9,200,105.9,199.8,105.9L199.8,105.9L199.8,105.9z',
    '24322' => 'M273.3,67.1c-0.1,0-0.1,0-0.2,0c-1.8,1.4-5.9,1.6-6,1.6c-6.9,0.8-6.9,7.5-6.9,7.8c0,0.1,0.1,0.1,0.1,0.2c0.1,0,0.1,0,0.2-0.1c0-0.1,1.5-4.7,6.4-5.8c-1.9,0.8-4.6,2.8-6.8,7.6c0,0.1,0,0.2,0.1,0.2l0.6,0.3c0,0,0,0,0.1,0c0.1,0,0.1,0,0.1-0.1l0.8-1.6c0.2,0,0.8-0.1,2.5,0c0.2,0,0.5,0,0.7,0c7.3,0,8.4-9.8,8.4-9.9C273.4,67.2,273.4,67.1,273.3,67.1L273.3,67.1L273.3,67.1z',
    '24037' => 'M252.8,95.9L252.8,95.9l-0.7-0.3c-0.1-0.1-0.2-0.2-0.1-0.4c1.7-3.8,3.8-5.9,5.5-7c-3.7,1.6-4.9,5.2-4.9,5.3c0,0.1-0.1,0.2-0.3,0.2c-0.2,0-0.3-0.1-0.3-0.3c0-0.3,0.1-7.1,7.1-7.9c0.2,0,4.2-0.2,5.9-1.6l0,0l0.1,0c0,0,0.1,0,0.1,0c0.1,0.1,0.2,0.2,0.1,0.3c0,0.1-1.2,10-8.5,10c-0.2,0-0.5,0-0.7,0c-0.6-0.1-1.1-0.1-1.5-0.1c-0.5,0-0.8,0-0.9,0.1l-0.8,1.6C253.1,95.9,253,95.9,252.8,95.9L252.8,95.9L252.8,95.9z'
];

$svg_content = '';

// === CONSTRUCTION DU SVG EN PHP ===
$svg_content .= '<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="436.5px" height="216.6px" viewBox="0 0 436.5 216.6" enable-background="new 0 0 436.5 216.6" xml:space="preserve">';

$svg_content .= '<g id="Air">';
foreach ($data as $code_postal => $cityData) {
    // Récupération des couleurs et tracés
    $air_color = $cityData['qualite_air']['coul_qual'];
    $air_picto_color = '#FFFFFF';
    $air_fond_d = $air_fond_paths[$code_postal] ?? '';
    $air_picto_d = $air_picto_paths[$code_postal] ?? '';

    // Construction des balises de chemin pour le fond de l'icône
    if ($air_fond_d) {
        $svg_content .= "<path id=\"{$code_postal}_Air_Fond\" fill=\"{$air_color}\" stroke=\"black\" stroke-width=\".25\" d=\"{$air_fond_d}\"/>";
    }

    // Construction des balises de chemin pour le pictogramme
    if ($air_picto_d) {
        $svg_content .= "<path id=\"{$code_postal}_Air_Picto\" fill=\"{$air_picto_color}\" d=\"{$air_picto_d}\"/>";
    }
}
$svg_content .= '</g>';

$svg_content .= '<g id="Pollen">';
foreach ($data as $code_postal => $cityData) {
    // Récupération des codes et tracés
    $pollen_code = $cityData['pollen']['code_qual'];
    $pollen_color = $pollen_colors[$pollen_code] ?? '#000000';
    $pollen_d = $pollen_paths[$code_postal] ?? '';

    // Construction des balises de chemin
    if ($pollen_d) {
        $svg_content .= "<path id=\"{$code_postal}_Pollen\" fill=\"{$pollen_color}\" stroke=\"black\" stroke-width=\".25\" d=\"{$pollen_d}\"/>";
    }
}
$svg_content .= '</g>';

$svg_content .= '</svg>';

// === AFFICHAGE DU SVG DANS LE PDF ===
$pdf->ImageSVG('@' . $svg_content, 0, 81 , 154, 76.4, '', 0, false);

// === SORTIE PDF ===
$date = date('d-m-Y', strtotime('+1 day'));
$dirOutput = dirname(__DIR__) . '/ProductionPdf';
$pdfFilename = 'Infog_Qualite_Air_' . $date . '.pdf';
$pdfPath = $dirOutput . '/' . $pdfFilename;

// Génération du PDF
$pdf->Output($pdfPath, 'F');